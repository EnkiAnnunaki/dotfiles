#!/usr/bin/env bash

# Usage: pm pipeline
curl -s 'https://gitlab.com/gitlab-com/www-gitlab-com/-/raw/master/data/stages.yml' | \
  yq '.stages.[].groups.[] | select(.name | test("(?i)'"$*"'")) | {"name": .name, "person": .pm}' -o=json | \
  jq -r '. | { name: .name, person: (.person | if type == "array" then .[] elif type == "null" then "None" else . end) } | (.name + ": " + .person)'
